/*

 Copyright (c) 2011 Sencha Inc. - Author: Nicolas Garcia Belmonte (http://philogb.github.com/)

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in
 all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.

*/
(function(){function p(t){return document.getElementById(t)}this.PhiloGL=null;(function(){PhiloGL=function(t,n){function m(a,c,g){c.use();var j=a.canvas,o=new PhiloGL.Camera(h.fov,j.width/j.height,h.near,h.far,h);o.update();var r=new PhiloGL.Scene(c,o,k),s={$$family:"app",gl:a,canvas:j,program:c,scene:r,camera:o};b&&PhiloGL.Events.create(j,p.extend(b,{bind:s}));if(d.src.length)new PhiloGL.IO.Textures(c,p.extend(d,{onComplete:function(){g(s)}}));else g(s)}n=p.merge({context:{},camera:{fov:45,near:0.1,
far:500},program:{from:"defaults",vs:"Default",fs:"Default"},scene:{},textures:{src:[]},events:{},onLoad:p.empty,onError:p.empty},n||{});var h=n.camera,b=n.events,d=n.textures,f=n.program,i=f.from,k=n.scene;l=PhiloGL.WebGL.getContext(t,n.context);if(!l){n.onError();return null}var q={defaults:"fromDefaultShaders",ids:"fromShaderIds",sources:"fromShaderSources",uris:"fromShaderURIs"},u;for(u in q)if(i==u){program=PhiloGL.Program[q[u]](p.extend({onSuccess:function(a){m(l,a,function(c){n.onLoad(c)})},
onError:function(a){n.onError(a)}},f));break}program&&m(l,program,function(a){n.onLoad(a)})}})();PhiloGL.unpack=function(){["Vec3","Mat4","Camera","Program","WebGL","O3D","Scene","Shaders","IO","Events","WorkerGroup","Fx"].forEach(function(t){window[t]=PhiloGL[t]})};PhiloGL.version="1.0.2";var l;p.empty=function(){};p.time=Date.now||function(){return+new Date};p.uid=function(){var t=p.time();return function(){return t++}}();p.extend=function(t,n){for(var m in n)t[m]=n[m];return t};p.type=function(){var t=
Object.prototype.toString,n=/^\[object\s(.*)\]$/;return function(m){var h=t.call(m).match(n)[1].toLowerCase();if(h!="object")return h;if(m.$$family)return m.$$family;return m&&m.nodeName&&m.nodeType==1?"element":h}}();(function(){function t(n){var m=p.type(n);if(m=="object"){m={};for(var h in n)m[h]=t(n[h]);return m}else if(m=="array"){m=[];h=0;for(var b=n.length;h<b;h++)m[h]=t(n[h]);return m}else return n}p.merge=function(){for(var n={},m=0,h=arguments.length;m<h;m++){var b=arguments[m];if(p.type(b)==
"object")for(var d in b){var f=b[d],i=n[d];n[d]=i&&p.type(f)=="object"&&p.type(i)=="object"?p.merge(i,f):t(f)}}return n}})();p.splat=function(){var t=Array.isArray;return function(n){return t(n)&&n||[n]}}();(function(){var t=Math.sqrt,n=Math.sin,m=Math.cos,h=Math.tan,b=Math.PI,d=Array.prototype.slice,f=function(a,c,g){this.x=a||0;this.y=c||0;this.z=g||0},i={setVec3:function(a,c){a.x=c.x;a.y=c.y;a.z=c.z;return a},set:function(a,c,g,j){a.x=c;a.y=g;a.z=j;return a},add:function(a,c){return new f(a.x+
c.x,a.y+c.y,a.z+c.z)},$add:function(a,c){a.x+=c.x;a.y+=c.y;a.z+=c.z;return a},add2:function(a,c,g){a.x=c.x+g.x;a.y=c.y+g.y;a.z=c.z+g.z;return a},sub:function(a,c){return new f(a.x-c.x,a.y-c.y,a.z-c.z)},$sub:function(a,c){a.x-=c.x;a.y-=c.y;a.z-=c.z;return a},sub2:function(a,c,g){a.x=c.x-g.x;a.y=c.y-g.y;a.z=c.z-g.z;return a},scale:function(a,c){return new f(a.x*c,a.y*c,a.z*c)},$scale:function(a,c){a.x*=c;a.y*=c;a.z*=c;return a},neg:function(a){return new f(-a.x,-a.y,-a.z)},$neg:function(a){a.x=-a.x;
a.y=-a.y;a.z=-a.z;return a},unit:function(a){var c=f.norm(a);if(c>0)return f.scale(a,1/c);return f.clone(a)},$unit:function(a){var c=f.norm(a);if(c>0)return f.$scale(a,1/c);return a},cross:function(a,c){var g=a.x,j=a.y,o=a.z,r=c.x,s=c.y,v=c.z;return new f(j*v-o*s,o*r-g*v,g*s-j*r)},$cross:function(a,c){var g=a.x,j=a.y,o=a.z,r=c.x,s=c.y,v=c.z;a.x=j*v-o*s;a.y=o*r-g*v;a.z=g*s-j*r;return a},distTo:function(a,c){var g=a.x-c.x,j=a.y-c.y,o=a.z-c.z;return t(g*g,j*j,o*o)},distToSq:function(a,c){var g=a.x-c.x,
j=a.y-c.y,o=a.z-c.z;return g*g+j*j+o*o},norm:function(a){var c=a.x,g=a.y;a=a.z;return t(c*c+g*g+a*a)},normSq:function(a){var c=a.x,g=a.y;a=a.z;return c*c+g*g+a*a},dot:function(a,c){return a.x*c.x+a.y*c.y+a.z*c.z},clone:function(a){return new f(a.x,a.y,a.z)}},k=f.prototype={},q;for(q in i){f[q]=i[q];k[q]=function(a){return function(){var c=d.call(arguments);c.unshift(this);return f[a].apply(f,c)}}(q)}var u=function(a,c,g,j,o,r,s,v,x,z,y,A,B,C,D,E){typeof a=="number"?this.set(a,c,g,j,o,r,s,v,x,z,y,
A,B,C,D,E):this.id()};i={id:function(a){a.n11=a.n22=a.n33=a.n44=1;a.n12=a.n13=a.n14=0;a.n21=a.n23=a.n24=0;a.n31=a.n32=a.n34=0;a.n41=a.n42=a.n43=0;return a},set:function(a,c,g,j,o,r,s,v,x,z,y,A,B,C,D,E,F){a.n11=c;a.n12=g;a.n13=j;a.n14=o;a.n21=r;a.n22=s;a.n23=v;a.n24=x;a.n31=z;a.n32=y;a.n33=A;a.n34=B;a.n41=C;a.n42=D;a.n43=E;a.n44=F;return a},mulVec3:function(a,c){var g=c.x,j=c.y,o=c.z;return new f(a.n11*g+a.n12*j+a.n13*o+a.n14,a.n21*g+a.n22*j+a.n23*o+a.n24,a.n31*g+a.n32*j+a.n33*o+a.n34)},$mulVec3:function(a,
c){var g=c.x,j=c.y,o=c.z;c.x=a.n11*g+a.n12*j+a.n13*o+a.n14;c.y=a.n21*g+a.n22*j+a.n23*o+a.n24;c.z=a.n31*g+a.n32*j+a.n33*o+a.n34;return c},mulMat42:function(a,c,g){var j=c.n11,o=c.n12,r=c.n13,s=c.n14,v=c.n21,x=c.n22,z=c.n23,y=c.n24,A=c.n31,B=c.n32,C=c.n33,D=c.n34,E=c.n41,F=c.n42,G=c.n43;c=c.n44;var H=g.n11,I=g.n12,J=g.n13,K=g.n14,L=g.n21,M=g.n22,N=g.n23,O=g.n24,P=g.n31,Q=g.n32,R=g.n33,w=g.n34,T=g.n41,U=g.n42,V=g.n43;g=g.n44;a.n11=j*H+o*L+r*P+s*T;a.n12=j*I+o*M+r*Q+s*U;a.n13=j*J+o*N+r*R+s*V;a.n14=j*K+
o*O+r*w+s*g;a.n21=v*H+x*L+z*P+y*T;a.n22=v*I+x*M+z*Q+y*U;a.n23=v*J+x*N+z*R+y*V;a.n24=v*K+x*O+z*w+y*g;a.n31=A*H+B*L+C*P+D*T;a.n32=A*I+B*M+C*Q+D*U;a.n33=A*J+B*N+C*R+D*V;a.n34=A*K+B*O+C*w+D*g;a.n41=E*H+F*L+G*P+c*T;a.n42=E*I+F*M+G*Q+c*U;a.n43=E*J+F*N+G*R+c*V;a.n44=E*K+F*O+G*w+c*g;return a},mulMat4:function(a,c){var g=a.n11,j=a.n12,o=a.n13,r=a.n14,s=a.n21,v=a.n22,x=a.n23,z=a.n24,y=a.n31,A=a.n32,B=a.n33,C=a.n34,D=a.n41,E=a.n42,F=a.n43,G=a.n44,H=c.n11,I=c.n12,J=c.n13,K=c.n14,L=c.n21,M=c.n22,N=c.n23,O=c.n24,
P=c.n31,Q=c.n32,R=c.n33,w=c.n34,T=c.n41,U=c.n42,V=c.n43,W=c.n44,S=new u;S.n11=g*H+j*L+o*P+r*T;S.n12=g*I+j*M+o*Q+r*U;S.n13=g*J+j*N+o*R+r*V;S.n14=g*K+j*O+o*w+r*W;S.n21=s*H+v*L+x*P+z*T;S.n22=s*I+v*M+x*Q+z*U;S.n23=s*J+v*N+x*R+z*V;S.n24=s*K+v*O+x*w+z*W;S.n31=y*H+A*L+B*P+C*T;S.n32=y*I+A*M+B*Q+C*U;S.n33=y*J+A*N+B*R+C*V;S.n34=y*K+A*O+B*w+C*W;S.n41=D*H+E*L+F*P+G*T;S.n42=D*I+E*M+F*Q+G*U;S.n43=D*J+E*N+F*R+G*V;S.n44=D*K+E*O+F*w+G*W;return S},$mulMat4:function(a,c){var g=a.n11,j=a.n12,o=a.n13,r=a.n14,s=a.n21,
v=a.n22,x=a.n23,z=a.n24,y=a.n31,A=a.n32,B=a.n33,C=a.n34,D=a.n41,E=a.n42,F=a.n43,G=a.n44,H=c.n11,I=c.n12,J=c.n13,K=c.n14,L=c.n21,M=c.n22,N=c.n23,O=c.n24,P=c.n31,Q=c.n32,R=c.n33,w=c.n34,T=c.n41,U=c.n42,V=c.n43,W=c.n44;a.n11=g*H+j*L+o*P+r*T;a.n12=g*I+j*M+o*Q+r*U;a.n13=g*J+j*N+o*R+r*V;a.n14=g*K+j*O+o*w+r*W;a.n21=s*H+v*L+x*P+z*T;a.n22=s*I+v*M+x*Q+z*U;a.n23=s*J+v*N+x*R+z*V;a.n24=s*K+v*O+x*w+z*W;a.n31=y*H+A*L+B*P+C*T;a.n32=y*I+A*M+B*Q+C*U;a.n33=y*J+A*N+B*R+C*V;a.n34=y*K+A*O+B*w+C*W;a.n41=D*H+E*L+F*P+G*T;
a.n42=D*I+E*M+F*Q+G*U;a.n43=D*J+E*N+F*R+G*V;a.n44=D*K+E*O+F*w+G*W;return a},add:function(a,c){var g=new u;g.n11=a.n11+c.n11;g.n12=a.n12+c.n12;g.n13=a.n13+c.n13;g.n14=a.n14+c.n14;g.n21=a.n21+c.n21;g.n22=a.n22+c.n22;g.n23=a.n23+c.n23;g.n24=a.n24+c.n24;g.n31=a.n31+c.n31;g.n32=a.n32+c.n32;g.n33=a.n33+c.n33;g.n34=a.n34+c.n34;g.n41=a.n41+c.n41;g.n42=a.n42+c.n42;g.n43=a.n43+c.n43;g.n44=a.n44+c.n44;return g},$add:function(a,c){a.n11+=c.n11;a.n12+=c.n12;a.n13+=c.n13;a.n14+=c.n14;a.n21+=c.n21;a.n22+=c.n22;
a.n23+=c.n23;a.n24+=c.n24;a.n31+=c.n31;a.n32+=c.n32;a.n33+=c.n33;a.n34+=c.n34;a.n41+=c.n41;a.n42+=c.n42;a.n43+=c.n43;a.n44+=c.n44;return a},transpose:function(a){return new u(a.n11,a.n21,a.n31,a.n41,a.n12,a.n22,a.n32,a.n42,a.n13,a.n23,a.n33,a.n43,a.n14,a.n24,a.n34,a.n44)},$transpose:function(a){return u.set(a,a.n11,a.n21,a.n31,a.n41,a.n12,a.n22,a.n32,a.n42,a.n13,a.n23,a.n33,a.n43,a.n14,a.n24,a.n34,a.n44)},rotateAxis:function(a,c,g){var j=n(c);c=m(c);var o=1-c,r=g.x,s=g.y;g=g.z;j=new u(r*r*o+c,r*s*
o-g*j,r*g*o+s*j,0,s*r*o+g*j,s*s*o+c,s*g*o-r*j,0,r*g*o-s*j,s*g*o+r*j,g*g*o+c,0,0,0,0,1);return u.mulMat4(a,j)},$rotateAxis:function(a,c,g){var j=n(c);c=m(c);var o=1-c,r=g.x,s=g.y;g=g.z;j=new u(r*r*o+c,r*s*o-g*j,r*g*o+s*j,0,s*r*o+g*j,s*s*o+c,s*g*o-r*j,0,r*g*o-s*j,s*g*o+r*j,g*g*o+c,0,0,0,0,1);return u.$mulMat4(a,j)},rotateXYZ:function(a,c,g,j){c=new u(m(g)*m(j),-m(c)*n(j)+n(c)*n(g)*m(j),n(c)*n(j)+m(c)*n(g)*m(j),0,m(g)*n(j),m(c)*m(j)+n(c)*n(g)*n(j),-n(c)*m(j)+m(c)*n(g)*n(j),0,-n(g),n(c)*m(g),m(c)*m(g),
0,0,0,0,1);return u.mulMat4(a,c)},$rotateXYZ:function(a,c,g,j){c=new u(m(g)*m(j),-m(c)*n(j)+n(c)*n(g)*m(j),n(c)*n(j)+m(c)*n(g)*m(j),0,m(g)*n(j),m(c)*m(j)+n(c)*n(g)*n(j),-n(c)*m(j)+m(c)*n(g)*n(j),0,-n(g),n(c)*m(g),m(c)*m(g),0,0,0,0,1);return u.$mulMat4(a,c)},translate:function(a,c,g,j){c=new u(1,0,0,c,0,1,0,g,0,0,1,j,0,0,0,1);return u.mulMat4(a,c)},$translate:function(a,c,g,j){c=new u(1,0,0,c,0,1,0,g,0,0,1,j,0,0,0,1);return u.$mulMat4(a,c)},scale:function(a,c,g,j){c=new u(c,0,0,0,0,g,0,0,0,0,j,0,0,
0,0,1);return u.mulMat4(a,c)},$scale:function(a,c,g,j){c=new u(c,0,0,0,0,g,0,0,0,0,j,0,0,0,0,1);return u.$mulMat4(a,c)},invert:function(a){var c=new u,g=a.n11,j=a.n12,o=a.n13,r=a.n14,s=a.n21,v=a.n22,x=a.n23,z=a.n24,y=a.n31,A=a.n32,B=a.n33,C=a.n34,D=a.n41,E=a.n42,F=a.n43;a=a.n44;var G=g*v-j*s,H=g*x-o*s,I=g*z-r*s,J=j*x-o*v,K=j*z-r*v,L=o*z-r*x,M=y*E-A*D,N=y*F-B*D,O=y*a-C*D,P=A*F-B*E,Q=A*a-C*E,R=B*a-C*F,w=1/(G*R-H*Q+I*P+J*O-K*N+L*M);c.n11=(+v*R-x*Q+z*P)*w;c.n12=(-j*R+o*Q-r*P)*w;c.n13=(+E*L-F*K+a*J)*w;
c.n14=(-A*L+B*K-C*J)*w;c.n21=(-s*R+x*O-z*N)*w;c.n22=(+g*R-o*O+r*N)*w;c.n23=(-D*L+F*I-a*H)*w;c.n24=(+y*L-B*I+C*H)*w;c.n31=(+s*Q-v*O+z*M)*w;c.n32=(-g*Q+j*O-r*M)*w;c.n33=(+D*K-E*I+a*G)*w;c.n34=(-y*K+A*I-C*G)*w;c.n41=(-s*P+v*N-x*M)*w;c.n42=(+g*P-j*N+o*M)*w;c.n43=(-D*J+E*H-F*G)*w;c.n44=(+y*J-A*H+B*G)*w;return c},$invert:function(a){var c=a.n11,g=a.n12,j=a.n13,o=a.n14,r=a.n21,s=a.n22,v=a.n23,x=a.n24,z=a.n31,y=a.n32,A=a.n33,B=a.n34,C=a.n41,D=a.n42,E=a.n43,F=a.n44,G=c*s-g*r,H=c*v-j*r,I=c*x-o*r,J=g*v-j*s,
K=g*x-o*s,L=j*x-o*v,M=z*D-y*C,N=z*E-A*C,O=z*F-B*C,P=y*E-A*D,Q=y*F-B*D,R=A*F-B*E,w=1/(G*R-H*Q+I*P+J*O-K*N+L*M);a.n11=(+s*R-v*Q+x*P)*w;a.n12=(-g*R+j*Q-o*P)*w;a.n13=(+D*L-E*K+F*J)*w;a.n14=(-y*L+A*K-B*J)*w;a.n21=(-r*R+v*O-x*N)*w;a.n22=(+c*R-j*O+o*N)*w;a.n23=(-C*L+E*I-F*H)*w;a.n24=(+z*L-A*I+B*H)*w;a.n31=(+r*Q-s*O+x*M)*w;a.n32=(-c*Q+g*O-o*M)*w;a.n33=(+C*K-D*I+F*G)*w;a.n34=(-z*K+y*I-B*G)*w;a.n41=(-r*P+s*N-v*M)*w;a.n42=(+c*P-g*N+j*M)*w;a.n43=(-C*J+D*H-E*G)*w;a.n44=(+z*J-y*H+A*G)*w;return a},lookAt:function(a,
c,g,j){g=f.sub(c,g);g.$unit();j=f.cross(j,g);j.$unit();var o=f.cross(g,j);o.$unit();return u.set(a,j.x,j.y,j.z,-j.dot(c),o.x,o.y,o.z,-o.dot(c),g.x,g.y,g.z,-g.dot(c),0,0,0,1)},frustum:function(a,c,g,j,o,r,s){return u.set(a,2*r/(g-c),0,(g+c)/(g-c),0,0,2*r/(o-j),(o+j)/(o-j),0,0,0,-(s+r)/(s-r),-2*s*r/(s-r),0,0,-1,0)},perspective:function(a,c,g,j,o){c=j*h(c*b/360);var r=-c;return u.frustum(a,r*g,c*g,r,c,j,o)},toFloat32Array:function(a){return new Float32Array([a.n11,a.n21,a.n31,a.n41,a.n12,a.n22,a.n32,
a.n42,a.n13,a.n23,a.n33,a.n43,a.n14,a.n24,a.n34,a.n44])}};k=u.prototype={};for(q in i){u[q]=i[q];k[q]=function(a){return function(){var c=d.call(arguments);c.unshift(this);return u[a].apply(u,c)}}(q)}PhiloGL.Vec3=f;PhiloGL.Mat4=u})();(function(){var t=function(b){var d=function(f){for(var i={x:0,y:0};f&&!/^(?:body|html)$/i.test(f.tagName);){i.x+=f.offsetLeft;i.y+=f.offsetTop;f=f.offsetParent}return i}(b);b=function(f){for(var i={x:0,y:0};f&&!/^(?:body|html)$/i.test(f.tagName);){i.x+=f.scrollLeft;
i.y+=f.scrollTop;f=f.parentNode}return i}(b);return{x:d.x-b.x,y:d.y-b.y}},n={get:function(b,d){return b||(d||window).event},getWheel:function(b){return b.wheelDelta?b.wheelDelta/120:-(b.detail||0)/3},getKey:function(b){var d=b.which||b.keyCode,f;a:{f=h.Keys;for(var i in f)if(f[i]==d){f=i;break a}f=void 0}i=d-111;if(i>0&&i<13)f="f"+i;f=f||String.fromCharCode(d).toLowerCase();return{code:d,key:f,shift:b.shiftKey,control:b.ctrlKey,alt:b.altKey,meta:b.metaKey}},isRightClick:function(b){return b.which==
3||b.button==2},getPos:function(b,d){d=d||window;b=b||d.event;var f=d.document;f=f.documentElement||f.body;if(b.touches&&b.touches.length)b=b.touches[0];return{x:b.pageX||b.clientX+f.scrollLeft,y:b.pageY||b.clientY+f.scrollTop}},stop:function(b){b.stopPropagation&&b.stopPropagation();b.cancelBubble=true;if(b.preventDefault)b.preventDefault();else b.returnValue=false}},m=function(b,d){this.domElem=b;this.pos=t(b);this.opt=this.callbacks=d;this.size={width:b.width||b.offsetWidth,height:b.height||b.offsetHeight};
this.attachEvents()};m.prototype={hovered:false,pressed:false,touched:false,touchMoved:false,moved:false,attachEvents:function(){var b=this.domElem,d=this;if(this.opt.disableContextMenu)b.oncontextmenu=function(){return false};["mouseup","mousedown","mousemove","mouseover","mouseout","touchstart","touchmove","touchend"].forEach(function(i){b.addEventListener(i,function(k,q){d[i](d.eventInfo(i,k,q))},false)});["keydown","keyup"].forEach(function(i){document.addEventListener(i,function(k,q){d[i](d.eventInfo(i,
k,q))},false)});var f="";f=!document.getBoxObjectFor&&window.mozInnerScreenX==null?"mousewheel":"DOMMouseScroll";b.addEventListener(f,function(i,k){d.mousewheel(d.eventInfo("mousewheel",i,k))},false)},eventInfo:function(b,d,f){var i=this.domElem,k=this.opt,q=this.getSize(),u=k.relative,a=k.centerOrigin;i=k.cachePosition&&this.pos||t(i);var c=n.get(d,f);k=n.getPos(d,f);d={};f=k.x;k=k.y;if(u){f-=i.x;k-=i.y;if(a){f-=q.width/2;k-=q.height/2;k*=-1}}switch(b){case "mousewheel":d.wheel=n.getWheel(c);break;
case "keydown":p.extend(d,n.getKey(c));break;case "mouseup":d.isRightClick=n.isRightClick(c)}p.extend(d,{x:f,y:k,stop:function(){n.stop(c)}});d.event=c;return d},getSize:function(){if(this.cacheSize)return this.size;var b=this.domElem;return{width:b.width||b.offsetWidth,height:b.height||b.offsetHeight}},mouseup:function(b){if(!this.moved)if(b.isRightClick)this.callbacks.onRightClick(b,this.hovered);else this.callbacks.onClick(b,this.pressed);if(this.pressed){if(this.moved)this.callbacks.onDragEnd(b,
this.pressed);else this.callbacks.onDragCancel(b,this.pressed);this.pressed=this.moved=false}},mouseout:function(b){for(var d=b.relatedTarget,f=this.domElem;d&&d.parentNode;){if(f==d.parentNode)return;d=d.parentNode}if(this.hovered){this.callbacks.onMouseLeave(b,this.hovered);this.hovered=false}},mouseover:function(){},mousemove:function(b){if(this.pressed){this.moved=true;this.callbacks.onDragMove(b,this.pressed)}else this.callbacks.onMouseMove(b,false)},mousewheel:function(b){this.callbacks.onMouseWheel(b)},
mousedown:function(b){this.pressed=true;this.callbacks.onDragStart(b,this.pressed)},touchstart:function(b){this.touched=true;this.callbacks.onTouchStart(b,this.touched)},touchmove:function(b){if(this.touched){this.touchMoved=true;this.callbacks.onTouchMove(b,this.touched)}},touchend:function(b){if(this.touched){if(this.touchMoved)this.callbacks.onTouchEnd(b,this.touched);else this.callbacks.onTouchCancel(b,this.touched);this.touched=this.touchMoved=false}},keydown:function(b){this.callbacks.onKeyDown(b)},
keyup:function(b){this.callbacks.onKeyUp(b)}};var h={};h.create=function(b,d){d=p.merge({cachePosition:true,cacheSize:true,relative:true,centerOrigin:true,disableContextMenu:true,bind:false,onClick:p.empty,onRightClick:p.empty,onDragStart:p.empty,onDragMove:p.empty,onDragEnd:p.empty,onDragCancel:p.empty,onTouchStart:p.empty,onTouchMove:p.empty,onTouchEnd:p.empty,onTouchCancel:p.empty,onMouseMove:p.empty,onMouseEnter:p.empty,onMouseLeave:p.empty,onMouseWheel:p.empty,onKeyDown:p.empty,onKeyUp:p.empty},
d||{});var f=d.bind;if(f)for(var i in d)i.match(/^on[a-zA-Z0-9]+$/)&&function(k,q){d[k]=function(){return q.apply(f,Array.prototype.slice.call(arguments))}}(i,d[i]);new m(b,d)};h.Keys={enter:13,up:38,down:40,left:37,right:39,esc:27,space:32,backspace:8,tab:9,"delete":46};PhiloGL.Events=h})();(function(){function t(){return arguments.length==2?{vs:arguments[0],fs:arguments[1]}:arguments[0]||{}}var n=function(b,d,f){var i=b.createShader(f);if(i==null)throw"Error creating the shader with shader type: "+
f;b.shaderSource(i,d);b.compileShader(i);if(!b.getShaderParameter(i,b.COMPILE_STATUS)){b.deleteShader(i);throw"Error while compiling the shader "+b.getShaderInfoLog(i);}return i},m=function(b,d){var f=l.getUniformLocation(b,d.name),i=d.type;switch(i){case l.FLOAT:return function(k){l.uniform1f(f,k)};case l.FLOAT_VEC2:return function(k){l.uniform2fv(f,new Float32Array(k))};case l.FLOAT_VEC3:return function(k){l.uniform3fv(f,new Float32Array(k))};case l.FLOAT_VEC4:return function(k){l.uniform4fv(f,
new Float32Array(k))};case l.INT:case l.BOOL:case l.SAMPLER_2D:case l.SAMPLER_CUBE:return function(k){l.uniform1i(f,k)};case l.INT_VEC2:case l.BOOL_VEC2:return function(k){l.uniform2iv(f,new Uint16Array(k))};case l.INT_VEC3:case l.BOOL_VEC3:return function(k){l.uniform3iv(f,new Uint16Array(k))};case l.INT_VEC4:case l.BOOL_VEC4:return function(k){l.uniform4iv(f,new Uint16Array(k))};case l.FLOAT_MAT2:return function(k){l.uniformMatrix2fv(f,false,k.toFloat32Array())};case l.FLOAT_MAT3:return function(k){l.uniformMatrix3fv(f,
false,k.toFloat32Array())};case l.FLOAT_MAT4:return function(k){l.uniformMatrix4fv(f,false,k.toFloat32Array())}}throw"Unknown type: "+i;},h=function(b,d){var f=l,i=f.createProgram();f.attachShader(i,n(f,b,f.VERTEX_SHADER));f.attachShader(i,n(f,d,f.FRAGMENT_SHADER));f.linkProgram(i);if(!f.getProgramParameter(i,f.LINK_STATUS))throw"Error linking the shader: "+f.getProgramInfoLog(i);if(!i)return false;f={};for(var k={},q=l.getProgramParameter(i,l.ACTIVE_ATTRIBUTES),u=0;u<q;u++){var a=l.getActiveAttrib(i,
u),c=a.name;a=l.getAttribLocation(i,a.name);f[c]=a}q=l.getProgramParameter(i,l.ACTIVE_UNIFORMS);for(u=0;u<q;u++){a=l.getActiveUniform(i,u);c=a.name;k[c]=m(i,a)}this.program=i;this.attributes=f;this.uniforms=k;this.buffers={};this.bufferMemo={};this.frameBuffers={};this.frameBufferMemo={};this.renderBuffers={};this.renderBufferMemo={};this.textures={};this.textureMemo={}};h.prototype={$$family:"program",setState:function(b){p.extend(b,{buffers:this.buffers,bufferMemo:this.bufferMemo,renderBuffers:this.renderBuffers,
renderBufferMemo:this.renderBufferMemo,frameBuffers:this.frameBuffers,frameBufferMemo:this.frameBufferMemo,textures:this.textures,textureMemo:this.textureMemo});return this},setUniform:function(b,d){if(this.uniforms[b])this.uniforms[b](d);return this},setUniforms:function(b){for(var d in b)this.uniforms[d](b[d]);return this},setBuffer:function(b,d){d=p.merge({bufferType:l.ARRAY_BUFFER,size:1,dataType:l.FLOAT,stride:0,offset:0,drawType:l.STATIC_DRAW},this.bufferMemo[b]||{},d||{});var f=d.attribute||
b,i=d.bufferType,k=b in this.buffers,q=k?this.buffers[b]:l.createBuffer(),u="value"in d,a=d.value,c=d.size,g=d.dataType,j=d.stride,o=d.offset,r=d.drawType;f=this.attributes[f];var s=f!==undefined;if(!k){this.buffers[b]=q;s&&l.enableVertexAttribArray(f)}l.bindBuffer(i,q);u&&l.bufferData(i,a,r);s&&l.vertexAttribPointer(f,c,g,false,j,o);delete d.value;this.bufferMemo[b]=d;return this},setBuffers:function(b){for(var d in b)this.setBuffer(d,b[d]);return this},setFrameBuffer:function(b,d){if(typeof d!=
"object")l.bindFramebuffer(l.FRAMEBUFFER,d?this.frameBuffers[b]:null);else{d=p.merge({width:0,height:0,bindToTexture:false,textureOptions:{attachment:l.COLOR_ATTACHMENT0},bindToRenderBuffer:false,renderBufferOptions:{attachment:l.DEPTH_ATTACHMENT}},this.frameBufferMemo[b]||{},d||{});var f=d.bindToTexture,i=d.bindToRenderBuffer,k=b in this.frameBuffers,q=k?this.frameBuffers[b]:l.createFramebuffer(l.FRAMEBUFFER);l.bindFramebuffer(l.FRAMEBUFFER,q);k||(this.frameBuffers[b]=q);if(f){f=p.merge({data:{width:d.width,
height:d.height}},p.type(f)=="object"?f:{});k=b+"-texture";q=d.textureOptions;this.setTexture(k,f);l.framebufferTexture2D(l.FRAMEBUFFER,q.attachment,this.textureMemo[k].textureType,this.textures[k],0)}if(i){i=p.merge({width:d.width,height:d.height},p.type(i)=="object"?i:{});f=b+"-renderbuffer";k=d.renderBufferOptions;this.setRenderBuffer(f,i);l.framebufferRenderbuffer(l.FRAMEBUFFER,k.attachment,l.RENDERBUFFER,this.renderBuffers[f])}l.bindTexture(l.TEXTURE_2D,null);l.bindRenderbuffer(l.RENDERBUFFER,
null);l.bindFramebuffer(l.FRAMEBUFFER,null);this.frameBufferMemo[b]=d;return this}},setFrameBuffers:function(b){for(var d in b)this.setFrameBuffer(d,b[d]);return this},setRenderBuffer:function(b,d){if(typeof d!="object")l.bindRenderbuffer(l.RENDERBUFFER,d?this.renderBufferMemo[b]:null);else{d=p.merge({storageType:l.DEPTH_COMPONENT16,width:0,height:0},this.renderBufferMemo[b]||{},d||{});var f=b in this.renderBuffers,i=f?this.renderBuffers[b]:l.createRenderbuffer(l.RENDERBUFFER);f||(this.renderBuffers[b]=
i);l.bindRenderbuffer(l.RENDERBUFFER,i);l.renderbufferStorage(l.RENDERBUFFER,d.storageType,d.width,d.height);this.renderBufferMemo[b]=d;return this}},setRenderBuffers:function(b){for(var d in b)this.setRenderBuffer(d,b[d]);return this},setTexture:function(b,d){if(!d||typeof d!="object"){l.activeTexture(d||l.TEXTURE0);l.bindTexture(this.textureMemo[b].textureType||l.TEXTURE_2D,this.textures[b])}else{d=p.merge({textureType:l.TEXTURE_2D,pixelStore:[{name:l.UNPACK_FLIP_Y_WEBGL,value:true}],parameters:[{name:l.TEXTURE_MAG_FILTER,
value:l.NEAREST},{name:l.TEXTURE_MIN_FILTER,value:l.NEAREST}],data:{format:l.RGBA,value:false,width:0,height:0,border:0}},this.textureMemo[b]||{},d||{});var f="textureType"in d?d.textureType:l.TEXTURE_2D,i=b in this.textures,k=i?this.textures[b]:l.createTexture(),q=d.pixelStore,u=d.parameters,a=d.data,c=!!d.data.value;i||(this.textures[b]=k);l.bindTexture(f,k);i||q.forEach(function(g){g.name=typeof g.name=="string"?l[g.name]:g.name;l.pixelStorei(g.name,g.value)});if(c)l.texImage2D(f,0,a.format,a.format,
l.UNSIGNED_BYTE,a.value);else if(a.width||a.height)l.texImage2D(f,0,a.format,a.width,a.height,a.border,a.format,l.UNSIGNED_BYTE,null);i||u.forEach(function(g){g.name=l.get(g.name);g.value=l.get(g.value);l.texParameteri(f,g.name,g.value);g.generateMipmap&&l.generateMipmap(f)});delete d.data;this.textureMemo[b]=d;return this}},setTextures:function(b){for(var d in b)this.setTexture(d,b[d]);return this},use:function(){l.useProgram(this.program);return this}};h.fromShaderIds=function(){var b=t.apply({},
arguments),d=p(b.vs);b=p(b.fs);return new h(d.innerHTML,b.innerHTML)};h.fromShaderSources=function(b){b=t.apply({},arguments);return new h(b.vs,b.fs)};h.fromDefaultShaders=function(){var b=t.apply({},arguments),d=PhiloGL.Shaders;return PhiloGL.Program.fromShaderSources(d.Vertex[b.vs||"Default"],d.Fragment[b.fs||"Default"])};h.fromShaderURIs=function(b){b=p.merge({path:"",vs:"",fs:"",noCache:false,onSuccess:p.empty,onError:p.empty},b||{});var d=b.path+b.fs,f=PhiloGL.IO.XHR;(new f({url:b.path+b.vs,
noCache:b.noCache,onError:function(i){b.onError(i)},onSuccess:function(i){(new f({url:d,noCache:b.noCache,onError:function(k){b.onError(k)},onSuccess:function(k){b.onSuccess(h.fromShaderSources(i,k))}})).send()}})).send()};PhiloGL.Program=h})();(function(){var t={},n=function(b){this.opt=b=p.merge({url:"http://sencha.com/",method:"GET",async:true,noCache:false,sendAsBinary:false,onProgress:p.empty,onSuccess:p.empty,onError:p.empty,onAbort:p.empty,onComplete:p.empty},b||{});this.initXHR()};n.State=
{};["UNINITIALIZED","LOADING","LOADED","INTERACTIVE","COMPLETED"].forEach(function(b,d){n.State[b]=d});n.prototype={initXHR:function(){var b=this.req=new XMLHttpRequest,d=this;["Progress","Error","Abort","Load"].forEach(function(f){b.addEventListener(f.toLowerCase(),function(i){d["handle"+f](i)},false)})},send:function(b){var d=this.req,f=this.opt,i=f.async;if(f.noCache)f.url+=(f.url.indexOf("?")>=0?"&":"?")+p.uid();d.open(f.method,f.url,i);if(i)d.onreadystatechange=function(){if(d.readyState==n.State.COMPLETED)if(d.status==
200)f.onSuccess(d.responseText);else f.onError(d.status)};f.sendAsBinary?d.sendAsBinary(b||f.body||null):d.send(b||f.body||null);if(!i)if(d.status==200)f.onSuccess(d.responseText);else f.onError(d.status)},setRequestHeader:function(b,d){this.req.setRequestHeader(b,d);return this},handleProgress:function(b){if(b.lengthComputable)this.opt.onProgress(b,Math.round(b.loaded/b.total*100));else this.opt.onProgress(b,-1)},handleError:function(b){this.opt.onError(b)},handleAbort:function(){this.opt.onAbort(e)},
handleLoad:function(b){this.opt.onComplete(b)}};var m=function(b){b=p.merge({url:"http://sencha.com/",data:{},noCache:false,onComplete:p.empty,callbackKey:"callback"},b||{});var d=m.counter++,f=[],i;for(i in b.data)f.push(i+"="+b.data[i]);f=f.join("&");if(b.noCache)f+=(f.indexOf("?")>=0?"&":"?")+p.uid();f=b.url+(b.url.indexOf("?")>-1?"&":"?")+b.callbackKey+"=PhiloGL.IO.JSONP.requests.request_"+d+(f.length>0?"&"+f:"");var k=document.createElement("script");k.type="text/javascript";k.src=f;m.requests["request_"+
d]=function(q){b.onComplete(q);k.parentNode&&k.parentNode.removeChild(k);k.clearAttributes&&k.clearAttributes()};document.getElementsByTagName("head")[0].appendChild(k)};m.counter=0;m.requests={};var h=function(b){b=p.merge({src:[],noCache:false,onProgress:p.empty,onComplete:p.empty},b||{});var d=0,f=b.src.length,i=function(){b.onProgress(Math.round(++d/f*100));if(d==f)b.onComplete(a)},k=function(){if(++d==f)b.onComplete(a)},q=b.noCache,u=p.uid(),a=b.src.map(function(c,g){var j=new Image;j.index=
g;j.onload=i;j.onerror=k;j.src=c+(q?(c.indexOf("?")>=0?"&":"?")+u:"");return j});return a};t.XHR=n;t.JSONP=m;t.Images=h;t.Textures=function(b,d){d=p.merge({src:[],noCache:false,onComplete:p.empty},d||{});h({src:d.src,noCache:d.noCache,onComplete:function(f){var i={};f.forEach(function(k,q){i[d.src[q]]=p.merge({data:{value:k}},d)});b.setTextures(i);d.onComplete()}})};PhiloGL.IO=t})();(function(){var t=PhiloGL.Vec3,n=PhiloGL.Mat4,m=function(h,b,d,f,i){i=i||{};var k=i.position,q=i.target;i=i.up;this.near=
d;this.far=f;this.position=k&&new t(k.x,k.y,k.z)||new t;this.target=q&&new t(q.x,q.y,q.z)||new t;this.up=i&&new t(i.x,i.y,i.z)||new t(0,1,0);this.projection=(new n).perspective(h,b,d,f);this.modelView=new n};m.prototype={update:function(){this.modelView.lookAt(this.position,this.target,this.up)}};PhiloGL.Camera=m})();(function(){try{PhiloGL.hasWebGL=!!window.WebGLRenderingContext}catch(t){PhiloGL.hasWebGL=false}PhiloGL.WebGL={getContext:function(n,m){n=typeof n=="string"?p(n):n;var h;(h=n.getContext("experimental-webgl",
m))||(h=n.getContext("webgl",m));if(h&&m&&m.debug){l={};for(var b in h){var d=h[b];l[b]=typeof d=="function"?function(f,i){return function(){console.log(f,Array.prototype.join.call(arguments),Array.prototype.slice.call(arguments));try{var k=i.apply(h,arguments)}catch(q){throw f+" "+q;}for(var u=[],a;(a=h.getError())!==h.NO_ERROR;)u.push(a);if(u.length)throw u.join();return k}}(b,d):d}}else l=h;l.get=function(f){return typeof f=="string"?l[f]:f};return l}}})();(function(){var t=PhiloGL.Vec3,n=PhiloGL.Mat4;
cos=Math.cos;sin=Math.sin;pi=Math.PI;max=Math.max;flatten=function(h){if(h&&h.length&&p.type(h[0])=="array")return[].concat.apply([],h);return h};var m={};m.Model=function(h){this.$$family="model";this.vertices=flatten(h.vertices);this.faces=flatten(h.faces);this.normals=flatten(h.normals);this.textures=h.textures&&p.splat(h.textures);this.centroids=flatten(h.centroids);this.colors=flatten(h.colors);this.indices=flatten(h.indices);this.shininess=h.shininess||0;this.uniforms=h.uniforms||{};this.render=
h.render;this.drawType=h.drawType;if(h.texCoords)this.texCoords=p.type(h.texCoords)=="object"?h.texCoords:flatten(h.texCoords);this.onBeforeRender=h.onBeforeRender||p.empty;this.onAfterRender=h.onAfterRender||p.empty;this.position=new t;this.rotation=new t;this.scale=new t(1,1,1);this.matrix=new n;this.normalizeColors();h.computeCentroids&&this.computeCentroids();h.computeNormals&&this.computeNormals()};m.Model.prototype={update:function(){var h=this.matrix,b=this.position,d=this.rotation,f=this.scale;
h.id();h.$translate(b.x,b.y,b.z);h.$rotateXYZ(d.x,d.y,d.z);h.$scale(f.x,f.y,f.z)},toFloat32Array:function(h){return new Float32Array(this[h])},toUint16Array:function(h){return new Uint16Array(this[h])},normalizeColors:function(){if(this.vertices){var h=this.vertices.length*4/3;if(this.colors&&this.colors.length<h){h/=this.colors.length;for(var b=this.colors,d=b.slice();--h;)b.push.apply(b,d)}}},computeCentroids:function(){var h=this.vertices,b=[];this.faces.forEach(function(d){var f=[0,0,0],i=0;d.forEach(function(k){k=
h[k];f[0]+=k[0];f[1]+=k[1];f[2]+=k[2];i++});f[0]/=i;f[1]/=i;f[2]/=i;b.push(f)});this.centroids=b},computeNormals:function(){var h=this.vertices,b=[];this.faces.forEach(function(d){var f=h[d[0]],i=h[d[1]];d=h[d[2]];f={x:f[0]-i[0],y:f[1]-i[1],z:f[2]-i[2]};t.$cross(f,{x:d[0]-i[0],y:d[1]-i[1],z:d[1]-i[2]});t.norm(f)>1.0E-6&&t.unit(f);b.push([f.x,f.y,f.z])});this.normals=b}};p.extend(m.Model.prototype,{setUniforms:function(h){h.setUniforms(this.uniforms)},setShininess:function(h){h.setUniform("shininess",
this.shininess||0)},setVertices:function(h,b){if(this.vertices)b||this.dynamic?h.setBuffer("vertices-"+this.id,{attribute:"position",value:this.toFloat32Array("vertices"),size:3}):h.setBuffer("vertices-"+this.id)},setNormals:function(h,b){if(this.normals)b||this.dynamic?h.setBuffer("normals-"+this.id,{attribute:"normal",value:this.toFloat32Array("normals"),size:3}):h.setBuffer("normals-"+this.id)},setIndices:function(h,b){if(this.indices)b||this.dynamic?h.setBuffer("indices-"+this.id,{bufferType:l.ELEMENT_ARRAY_BUFFER,
drawType:l.STATIC_DRAW,value:this.toUint16Array("indices"),size:1}):h.setBuffer("indices-"+this.id)},setColors:function(h,b){if(this.colors)b||this.dynamic?h.setBuffer("colors-"+this.id,{attribute:"color",value:this.toFloat32Array("colors"),size:4}):h.setBuffer("colors-"+this.id)},setTexCoords:function(h,b){if(this.texCoords){var d=this.id;if(b||this.dynamic)p.type(this.texCoords)=="object"?this.textures.forEach(function(f,i){h.setBuffer("texCoords-"+i+"-"+d,{attribute:"texCoord"+(i+1),value:new Float32Array(this.texCoords[f]),
size:2})}):h.setBuffer("texCoords-"+d,{attribute:"texCoord1",value:this.toFloat32Array("texCoords"),size:2});else p.type(this.texCoords)=="object"?this.textures.forEach(function(f,i){h.setBuffer("texCoords-"+i+"-"+d)}):h.setBuffer("texCoords-"+d)}},setTextures:function(h){this.textures=this.textures?p.splat(this.textures):[];for(var b=0,d=this.textures,f=d.length;b<PhiloGL.Scene.MAX_TEXTURES;b++)if(b<f){h.setUniform("hasTexture"+(b+1),true);h.setUniform("sampler"+(b+1),b);h.setTexture(d[b],l["TEXTURE"+
b])}else h.setUniform("hasTexture"+(b+1),false)}});m.Cube=function(h){m.Model.call(this,p.extend({vertices:[-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1],texCoords:[0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1],normals:[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,
0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0],indices:[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]},h||{}))};m.Cube.prototype=Object.create(m.Model.prototype);m.Sphere=function(h){var b=h.nlat||10,d=h.nlong||10,f=h.radius||1,i=pi-0,k=2*pi-0,q=[],u=[],a=[],c=[];if(typeof f=="number"){var g=f;f=function(){return g}}for(var j=0;j<=d;j++)for(var o=0;o<=b;o++){var r=o/b,s=j/d,v=k*r,x=i*s,z=sin(v),y=cos(v);v=sin(x);var A=cos(x);x=y*v;y=A;
z*=v;v=f(x,y,z,r,s);q.push(v*x,v*y,v*z);u.push(x,y,z);a.push(r,s)}f=b+1;for(o=0;o<b;o++)for(j=0;j<d;j++){c.push(j*f+o,j*f+o+1,(j+1)*f+o);c.push((j+1)*f+o,j*f+o+1,(j+1)*f+o+1)}m.Model.call(this,p.extend({vertices:q,indices:c,normals:u,texCoords:a},h||{}))};m.Sphere.prototype=Object.create(m.Model.prototype);PhiloGL.O3D=m})();(function(){var t={Vertex:{},Fragment:{}},n=t.Fragment;t.Vertex.Default="attribute vec3 position;\nattribute vec3 normal;\nattribute vec4 color;\nattribute vec2 texCoord1;\nuniform mat4 modelViewMatrix;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 normalMatrix;\nuniform bool enableLights;\nuniform vec3 ambientColor;\nuniform vec3 directionalColor;\nuniform vec3 lightingDirection;\nuniform bool enablePoint1;\nuniform vec3 pointLocation1;\nuniform vec3 pointColor1;\nuniform bool enablePoint2;\nuniform vec3 pointLocation2;\nuniform vec3 pointColor2;\nuniform bool enablePoint3;\nuniform vec3 pointLocation3;\nuniform vec3 pointColor3;\nvarying vec4 vColor;\nvarying vec2 vTexCoord;\nvarying vec3 lightWeighting;\nvoid main(void) {\nvec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\nif(!enableLights) {\nlightWeighting = vec3(1.0, 1.0, 1.0);\n} else {\nvec3 plightDirection;\nvec3 pointWeight1 = vec3(0.0, 0.0, 0.0);\nvec3 pointWeight2 = vec3(0.0, 0.0, 0.0);\nvec3 pointWeight3 = vec3(0.0, 0.0, 0.0);\nvec4 transformedNormal = normalMatrix * vec4(normal, 1.0);\nfloat directionalLightWeighting = max(dot(transformedNormal.xyz, lightingDirection), 0.0);\nif(enablePoint1) {\nplightDirection = normalize((viewMatrix * vec4(pointLocation1, 1.0)).xyz - mvPosition.xyz);\npointWeight1 = max(dot(transformedNormal.xyz, plightDirection), 0.0) * pointColor1;\n}\nif(enablePoint2) {\nplightDirection = normalize((viewMatrix * vec4(pointLocation2, 1.0)).xyz - mvPosition.xyz);\npointWeight2 = max(dot(transformedNormal.xyz, plightDirection), 0.0) * pointColor2;\n}\nif(enablePoint3) {\nplightDirection = normalize((viewMatrix * vec4(pointLocation3, 1.0)).xyz - mvPosition.xyz);\npointWeight3 = max(dot(transformedNormal.xyz, plightDirection), 0.0) * pointColor3;\n}\nlightWeighting = ambientColor + (directionalColor * directionalLightWeighting) + pointWeight1 + pointWeight2 + pointWeight3;\n}\nvColor = color;\nvTexCoord = texCoord1;\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}";
n.Default="#ifdef GL_ES\nprecision highp float;\n#endif\nvarying vec4 vColor;\nvarying vec2 vTexCoord;\nvarying vec3 lightWeighting;\nuniform bool hasTexture1;\nuniform sampler2D sampler1;\nuniform bool hasFog;\nuniform vec3 fogColor;\nuniform float fogNear;\nuniform float fogFar;\nvoid main(){\nif(!hasTexture1) {\ngl_FragColor = vec4(vColor.rgb * lightWeighting, vColor.a);\n} else {\ngl_FragColor = vec4(texture2D(sampler1, vec2(vTexCoord.s, vTexCoord.t)).rgb * lightWeighting, 1.0);\n}\nif (hasFog) {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat fogFactor = smoothstep(fogNear, fogFar, depth);\ngl_FragColor = mix(gl_FragColor, vec4(fogColor, gl_FragColor.w), fogFactor);\n}\n}";
PhiloGL.Shaders=t})();(function(){var t=PhiloGL.Vec3,n=PhiloGL.Mat4,m=function(h,b,d){d=p.merge({lights:{enable:false,ambient:{r:0.2,g:0.2,b:0.2},directional:{direction:{x:1,y:1,z:1},color:{r:0,g:0,b:0}}},effects:{fog:false}},d||{});this.program=h;this.camera=b;this.models=[];this.config=d};m.prototype={add:function(){for(var h=0,b=this.models,d=arguments.length;h<d;h++){var f=arguments[h];f.id=f.id||m.id++;b.push(f);this.defineBuffers(f)}},defineBuffers:function(h){var b=this.program;h.setVertices(b,
true);h.setColors(b,true);h.setNormals(b,true);h.setTexCoords(b,true);h.setIndices(b,true)},beforeRender:function(){this.setupLighting();this.setupEffects();var h=this.camera,b=this.program;b.setUniform("projectionMatrix",h.projection);b.setUniform("viewMatrix",h.modelView)},setupLighting:function(){var h=this.program,b=this.config.lights,d=b.ambient,f=b.directional,i=f.color,k=f.direction;f=b.points&&p.splat(b.points)||[];t.$unit(k);t.$scale(k,-1);h.setUniform("enableLights",b.enable);if(b.enable){h.setUniform("ambientColor",
[d.r,d.g,d.b]);h.setUniform("directionalColor",[i.r,i.g,i.b]);h.setUniform("lightingDirection",[k.x,k.y,k.z])}h.setUniform("enableSpecularHighlights",false);b=0;d=m.MAX_POINT_LIGHTS;for(i=f.length;b<d;b++){k=b+1;if(b<i){var q=f[b],u=q.position,a=q.color||q.diffuse;q=q.specular;h.setUniform("enablePoint"+k,true);h.setUniform("pointLocation"+k,[u.x,u.y,u.z]);h.setUniform("pointColor"+k,[a.r,a.g,a.b]);if(q){h.setUniform("enableSpecularHighlights",true);h.setUniform("pointSpecularColor"+k,[q.r,q.g,q.b])}}else h.setUniform("enablePoint"+
k,false)}},setupEffects:function(){var h=this.program,b=this.config.effects.fog,d=b.color||{r:0.5,g:0.5,b:0.5};b?h.setUniforms({hasFog:true,fogNear:b.near,fogFar:b.far,fogColor:[d.r,d.g,d.b]}):h.setUniform("hasFog",false)},render:function(){var h=this.program,b=this.camera;this.beforeRender();this.models.forEach(function(d){d.onBeforeRender(h,b);this.renderObject(d);d.onAfterRender(h,b)},this)},renderToTexture:function(h){var b=this.program,d=b.textures[h+"-texture"];h=b.textureMemo[h+"-texture"];
this.render();l.bindTexture(h.textureType,d);l.generateMipmap(h.textureType);l.bindTexture(h.textureType,null)},renderObject:function(h){var b=this.program,d=this.camera,f=new n;h.setUniforms(b);h.setShininess(b);h.setVertices(b);h.setColors(b);h.setNormals(b);h.setTextures(b);h.setTexCoords(b);h.setIndices(b);f.mulMat42(d.modelView,h.matrix);b.setUniform("modelViewMatrix",f);b.setUniform("normalMatrix",f.invert().$transpose());if(h.render)h.render(l,b,d);else h.indices?l.drawElements(h.drawType!==
undefined?l.get(h.drawType):l.TRIANGLES,h.indices.length,l.UNSIGNED_SHORT,0):l.drawArrays(l.get(h.drawType||"TRIANGLES"),0,h.toFloat32Array("vertices").length/3)}};m.id=p.time();m.MAX_TEXTURES=3;m.MAX_POINT_LIGHTS=3;PhiloGL.Scene=m})();(function(){function t(n,m){for(var h=this.workers=[];m--;)h.push(new Worker(n))}t.prototype={map:function(n){var m=this.workers,h=this.configs=[],b=0;for(m=m.length;b<m;b++)h.push(n&&n(b));return this},reduce:function(n){for(var m=n.reduceFn,h=this.workers,b=this.configs,
d=h.length,f=n.initialValue,i=function(a){d--;f=f===undefined?a.data:m(f,a.data);if(d==0)n.onComplete(f)},k=0,q=d;k<q;k++){var u=h[k];u.onmessage=i;u.postMessage(b[k])}return this}};PhiloGL.WorkerGroup=t})();(function(){var t=function(b){this.opt=p.merge({duration:1E3,transition:function(d){return d},onCompute:p.empty,onComplete:p.empty},b||{})};t.prototype={timer:null,time:null,start:function(b){this.opt=p.merge(this.opt,b||{});this.time=p.time();this.animating=true},step:function(){if(this.animating){var b=
p.time(),d=this.time,f=this.opt;if(b<d+f.duration){b=f.transition((b-d)/f.duration);f.onCompute.call(this,b)}else{this.animating=false;f.onCompute.call(this,1);f.onComplete.call(this)}}}};t.compute=function(b,d,f){return b+(d-b)*f};t.Transition={linear:function(b){return b}};var n=t.Transition;(function(){var b=function(i,k){k=p.splat(k);return p.extend(i,{easeIn:function(q){return i(q,k)},easeOut:function(q){return 1-i(1-q,k)},easeInOut:function(q){return q<=0.5?i(2*q,k)/2:(2-i(2*(1-q),k))/2}})},
d={Pow:function(i,k){return Math.pow(i,k[0]||6)},Expo:function(i){return Math.pow(2,8*(i-1))},Circ:function(i){return 1-Math.sin(Math.acos(i))},Sine:function(i){return 1-Math.sin((1-i)*Math.PI/2)},Back:function(i,k){k=k[0]||1.618;return Math.pow(i,2)*((k+1)*i-k)},Bounce:function(i){for(var k,q=0,u=1;;q+=u,u/=2)if(i>=(7-4*q)/11){k=u*u-Math.pow((11-6*q-11*i)/4,2);break}return k},Elastic:function(i,k){return Math.pow(2,10*--i)*Math.cos(20*i*Math.PI*(k[0]||1)/3)}},f;for(f in d)n[f]=b(d[f]);["Quad","Cubic",
"Quart","Quint"].forEach(function(i,k){n[i]=b(function(q){return Math.pow(q,[k+2])})})})();var m=self||window;if(m){var h=false;["webkitAnimationTime","mozAnimationTime","animationTime","webkitAnimationStartTime","mozAnimationStartTime","animationStartTime"].forEach(function(b){if(b in m){t.animationTime=function(){return m[b]};h=true}});if(!h)t.animationTime=p.time;h=false;["webkitRequestAnimationFrame","mozRequestAnimationFrame","requestAnimationFrame"].forEach(function(b){if(b in m){t.requestAnimationFrame=
function(d){m[b](function(){d()})};h=true}});if(!h)t.requestAnimationFrame=function(b){setTimeout(function(){b()},1E3/60)}}PhiloGL.Fx=t})()})();
